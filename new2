#!/usr/bin/env python3
â€œâ€â€
Script principal pour exÃ©cuter les tests end-to-end Guacamole
â€œâ€â€
import sys
import argparse
from pathlib import Path

# Ajouter le rÃ©pertoire parent au path pour les imports

sys.path.append(str(Path(**file**).parent))

from guacamole_test_manager import GuacamoleTestManager

def main():
â€œâ€â€œFonction principaleâ€â€â€
parser = argparse.ArgumentParser(description=â€œTests E2E pour Guacamoleâ€)
parser.add_argument(â€â€“output-dirâ€, â€œ-oâ€, default=â€œtest_outputsâ€,
help=â€œRÃ©pertoire de sortie pour les screenshots et logsâ€)
parser.add_argument(â€â€“headlessâ€, action=â€œstore_trueâ€,
help=â€œExÃ©cuter en mode headlessâ€)
parser.add_argument(â€â€“max-retriesâ€, â€œ-râ€, type=int, default=3,
help=â€œNombre maximum de tentatives par actionâ€)
parser.add_argument(â€â€“guacamole-urlâ€, default=â€œhttp://192.168.210.36:8080â€,
help=â€œURL de Guacamoleâ€)
parser.add_argument(â€â€“guacamole-userâ€, default=â€œadmpsnâ€,
help=â€œUtilisateur Guacamoleâ€)
parser.add_argument(â€â€“guacamole-passâ€, default=â€œExpression69CTâ€,
help=â€œMot de passe Guacamoleâ€)
parser.add_argument(â€â€“ulysse-userâ€, default=â€œpsn-consult-b.psn-consult-bâ€,
help=â€œUtilisateur Ulysseâ€)
parser.add_argument(â€â€“ulysse-passâ€, default=â€œLU78RK93â€,
help=â€œMot de passe Ulysseâ€)

```
args = parser.parse_args()

# CrÃ©er le gestionnaire de test
test_manager = GuacamoleTestManager(
    output_dir=args.output_dir,
    max_retries=args.max_retries
)

try:
    print(f"ğŸš€ DÃ©but du test E2E Guacamole")
    print(f"ğŸ“ RÃ©pertoire de sortie: {test_manager.output_dir}")
    print(f"ğŸ“¸ Screenshots: {test_manager.screenshots_dir}")
    print(f"ğŸ“ Logs: {test_manager.logs_dir}")
    print("-" * 50)
    
    # Configuration du navigateur
    print("âš™ï¸  Initialisation du navigateur...")
    if not test_manager.setup_browser(headless=args.headless):
        print("âŒ Erreur lors de l'initialisation du navigateur")
        return 1
    
    # Connexion Ã  Guacamole
    print("ğŸ”— Connexion Ã  Guacamole...")
    if not test_manager.connect_to_guacamole(
        url=args.guacamole_url,
        username=args.guacamole_user,
        password=args.guacamole_pass
    ):
        print("âŒ Erreur lors de la connexion Ã  Guacamole")
        return 1
    
    # Attendre le bureau Windows
    print("ğŸ–¥ï¸  Attente du bureau Windows...")
    if not test_manager.wait_for_desktop():
        print("âŒ Bureau Windows non accessible")
        return 1
    
    # Lancer Edge
    print("ğŸŒ Lancement d'Edge...")
    if not test_manager.launch_edge_browser():
        print("âŒ Erreur lors du lancement d'Edge")
        return 1
    
    # Ouvrir Ulysse
    print("ğŸ“± Ouverture d'Ulysse...")
    if not test_manager.open_ulysse_application():
        print("âŒ Erreur lors de l'ouverture d'Ulysse")
        return 1
    
    # Connexion Ã  Ulysse
    print("ğŸ” Connexion Ã  Ulysse...")
    if not test_manager.login_to_ulysse(
        username=args.ulysse_user,
        password=args.ulysse_pass
    ):
        print("âŒ Erreur lors de la connexion Ã  Ulysse")
        return 1
    
    # Recherche et ouverture d'Iliad
    print("ğŸ” Recherche et ouverture d'Iliad...")
    if not test_manager.search_and_open_iliad():
        print("âŒ Erreur lors de l'ouverture d'Iliad")
        return 1
    
    # Configuration du site Iliad
    print("âš™ï¸  Configuration du site Iliad...")
    if not test_manager.configure_iliad_site():
        print("âŒ Erreur lors de la configuration du site")
        return 1
    
    # Connexion au site
    print("ğŸŒ Connexion au site Iliad...")
    if not test_manager.connect_to_iliad_site():
        print("âŒ Erreur lors de la connexion au site")
        return 1
    
    # Fermeture des applications
    print("ğŸšª Fermeture des applications...")
    if not test_manager.quit_applications():
        print("âš ï¸  ProblÃ¨me lors de la fermeture (non critique)")
    
    print("-" * 50)
    print("âœ… Test terminÃ© avec succÃ¨s!")
    print(f"ğŸ“Š Nombre total d'Ã©tapes: {test_manager.current_step}")
    print(f"ğŸ“ RÃ©sultats disponibles dans: {test_manager.output_dir}")
    
    return 0
    
except KeyboardInterrupt:
    print("\nâ¹ï¸  Test interrompu par l'utilisateur")
    return 130
except Exception as e:
    print(f"âŒ Erreur critique: {e}")
    test_manager.logger.exception("Erreur critique dans le script principal")
    return 1
finally:
    test_manager.cleanup()
```

if **name** == â€œ**main**â€:
sys.exit(main())